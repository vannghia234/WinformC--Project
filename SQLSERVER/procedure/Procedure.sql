--- Proc xóa sản phẩm
CREATE PROC DELETE_SP @MASP VARCHAR(10)
AS
BEGIN
	DELETE FROM dbo.SANPHAM WHERE MASP = @MASP
END

EXEC dbo.DELETE_SP @MASP = 'SP20' -- varchar(10)
 
 DELETE FROM dbo.KHACHHANG WHERE MAKH = 'KH15'
 DELETE FROM dbo.TAIKHOAN WHERE TAIKHOAN = 'taikhoan1'

 ALTER TABLE dbo.HOADON
 ADD CONSTRAINT FK_KHHD
 FOREIGN KEY (MAKH) REFERENCES dbo.KHACHHANG(MAKH) ON DELETE SET NULL;

 -- Check valid Login
CREATE OR ALTER PROC CHECK_LOGIN @USERNAME NVARCHAR(50), @PASS NVARCHAR(50)
AS
BEGIN
	IF EXISTS(SELECT * FROM dbo.TAIKHOAN WHERE TAIKHOAN = @USERNAME AND MATKHAU = @PASS COLLATE SQL_Latin1_General_CP1_CS_AS  AND MALOAI = 1)
		SELECT 1 AS CODE
	ELSE IF EXISTS(SELECT * FROM dbo.TAIKHOAN WHERE TAIKHOAN = @USERNAME AND MATKHAU = @PASS COLLATE SQL_Latin1_General_CP1_CS_AS  AND MALOAI = 2)
		SELECT 2 AS CODE
	ELSE IF EXISTS(SELECT * FROM dbo.TAIKHOAN WHERE TAIKHOAN = @USERNAME AND MATKHAU != @PASS COLLATE SQL_Latin1_General_CP1_CS_AS  )
		SELECT 3 AS CODE
	ELSE
		SELECT 4 AS CODE
END

EXEC CHECK_LOGIN 'ADMIN', 'ADMIN1234'

-- Lấy sản phẩm
CREATE PROC GET_PRODUCT
AS 
BEGIN
	SELECT MASP, TENSP, GIATIEN, DONVITINH, SOLUONGTON, TENKHO FROM dbo.SANPHAM, dbo.KHO WHERE dbo.SANPHAM.MAKHO = dbo.KHO.MAKHO

END
EXEC GET_PRODUCT

----- Insert Hóa đơn 
CREATE OR ALTER PROC INSERT_HOADON @MAHD VARCHAR(10), @MANV VARCHAR(10), 
@MAKH VARCHAR(10), @NGAYLAP DATE, @KHUYENMAI INT, @THANHTIEN MONEY
AS
BEGIN
	INSERT INTO dbo.HOADON
	(
	    MAHD,
	    MANV,
	    MAKH,
	    NGAYLAP,
	    THANHTIEN,
	    KHUYENMAI
	)
	VALUES
	(   @MAHD,        -- MAHD - varchar(10)
	    @MANV,        -- MANV - varchar(10)
	    @MAKH,        -- MAKH - varchar(10)
	    @NGAYLAP, -- NGAYLAP - date
	    @THANHTIEN,      -- THANHTIEN - money
	    @KHUYENMAI       -- KHUYENMAI - float
	    )
END
EXEC dbo.INSERT_HOADON @MAHD = 'HDA2A4',              -- varchar(10)
                       @MANV = 'NV01',              -- varchar(10)
                       @MAKH = 'KH01',              -- varchar(10)
                       @NGAYLAP = '', -- date
                       @KHUYENMAI = 10,          -- int
                       @THANHTIEN = 50000000      -- money

-- insert  Giỏ hàng
CREATE PROC INSERT_GIOHANG @MAHD VARCHAR(10), @MASP VARCHAR(10), @SOLUONG INT, @GIABAN MONEY
AS
BEGIN
	INSERT INTO dbo.GIOHANG
	(
	    MAHD,
	    MASP,
	    SOLUONG,
	    GIABAN
	)
	VALUES
	(   @MAHD,  -- MAHD - varchar(10)
	    @MASP,  -- MASP - varchar(10)
	    @SOLUONG,   -- SOLUONG - int
	    @GIABAN -- GIABAN - money
	    )
END
EXEC dbo.INSERT_GIOHANG @MAHD = 'HD11',    -- varchar(10)
                        @MASP = 'SP11',    -- varchar(10)
                        @SOLUONG = 10,  -- int
                        @GIABAN = 500000 -- money

GO
------ cập nhật trạng thái thanh toán
CREATE PROC UPDATE_TRANGTHAI @MAHD VARCHAR(10)
AS
BEGIN
	UPDATE dbo.HOADON SET TRANGTHAI = N'ĐÃ THANH TOÁN' WHERE MAHD = @MAHD

END
EXEC dbo.UPDATE_TRANGTHAI @MAHD = '5ZEGIG1N' -- varchar(10)



-- THÔNG TIN HÓA ĐƠN BÁN HÀNG
GO
CREATE OR ALTER PROC GET_INF_INVOICE @MAHD VARCHAR(10)
AS
BEGIN
	SELECT SP.TENSP, SP.HANSUDUNG, GH.SOLUONG, GH.GIABAN,HD.MAHD
	FROM dbo.HOADON HD, dbo.SANPHAM SP, dbo.GIOHANG GH
	WHERE HD.MAHD = GH.MAHD AND GH.MASP = SP.MASP AND HD.MAHD = @MAHD
END
GO
EXEC GET_INF_INVOICE 'HD01'
<<<<<<< HEAD

--- THỐNG KÊ DOANH THU 
CREATE OR ALTER PROC TKDT_NAM
AS
BEGIN
SELECT SUM(THANHTIEN) DOANHTHU, MONTH(NGAYLAP) THANG
FROM dbo.HOADON 
WHERE MONTH(NGAYLAP) BETWEEN 1 AND 12
GROUP BY MONTH(NGAYLAP)
END
EXEC TKDT_NAM
--- TK SLUONG HÓA ĐƠN
CREATE OR ALTER PROC TKSLHD
AS
BEGIN
SELECT COUNT(*) SOLUONGHD, MONTH(NGAYLAP) THANG
FROM dbo.HOADON
WHERE MONTH(NGAYLAP) BETWEEN 1 AND 12
GROUP BY MONTH(NGAYLAP) 
END
EXEC TKSLHD
---SANPHAM
=======
----SANPHAM
>>>>>>> 75a710f8893a2eb304993394c51cc36fd69a9a9a
CREATE PROC INSERT_SANPHAM @MASP VARCHAR(10), @TENSP NVARCHAR(100), @GIATIEN MONEY, @DONVITINH NVARCHAR (10),@HANSUDUNG DATE,@SOLUONGTON INT,@MAKHO VARCHAR(10),@MALOAI VARCHAR(10)
AS
BEGIN
	INSERT INTO SANPHAM
	(
	    MASP,
	    TENSP,
	    GIATIEN,
	    DONVITINH,
		HANSUDUNG,
		SOLUONGTON,
		MAKHO,
		MALOAI
	)
	VALUES
	(   @MASP,
	    @TENSP,  
	    @GIATIEN,   
	    @DONVITINH,
		@HANSUDUNG,
		@SOLUONGTON,
		@MAKHO,
		@MALOAI
	    )
END
---SANPHAM
CREATE PROC DELETE_SP @MASP VARCHAR(10)
AS
BEGIN
	DELETE SANPHAM WHERE MASP = @MASP
END
---SANPHAM
<<<<<<< HEAD
DROP PROC CHANGE_SANPHAM
=======
>>>>>>> 75a710f8893a2eb304993394c51cc36fd69a9a9a
CREATE PROC CHANGE_SANPHAM @MASP VARCHAR(10), @TENSP NVARCHAR(100), @GIATIEN MONEY, @DONVITINH NVARCHAR (10),@HANSUDUNG DATE,@SOLUONGTON INT,@MAKHO VARCHAR(10),@MALOAI VARCHAR(10)
AS
BEGIN
	UPDATE SANPHAM SET
	TENSP = @TENSP,
	GIATIEN = @GIATIEN,
	DONVITINH = @DONVITINH,
	HANSUDUNG = @HANSUDUNG,
	SOLUONGTON = @SOLUONGTON,
	MAKHO = @MAKHO,
	MALOAI = @MALOAI
	WHERE MASP = @MASP
END
<<<<<<< HEAD
=======
---SANPHAM
CREATE PROC SEACH_SANPHAM @MASP VARCHAR(10)
AS
BEGIN
	SELECT * FROM SANPHAM
	WHERE MASP = @MASP
END
>>>>>>> 75a710f8893a2eb304993394c51cc36fd69a9a9a
---NHACC
CREATE PROC INSERT_NHACC @MANCC VARCHAR(10), @TENNCC NVARCHAR(50), @SDT VARCHAR (20),@DIACHI NVARCHAR(100)
AS
BEGIN
	INSERT INTO NHACUNGCAP
	(
	    MANCC,
	    TENNCC,
	    SDT,
		DIACHI
	)
	VALUES
	(   @MANCC,
		@TENNCC,  
	    @SDT,   
	    @DIACHI
	)
END
---NHACC
CREATE PROC DELETE_NHACC @MANCC VARCHAR(10)
AS
BEGIN
	DELETE NHACUNGCAP WHERE MANCC = @MANCC
END
---NHACC
CREATE PROC CHANGE_NHACC @MANCC VARCHAR(10), @TENNCC NVARCHAR(50), @SDT VARCHAR (20),@DIACHI NVARCHAR(100)
AS
BEGIN
	UPDATE NHACUNGCAP SET
	TENNCC = @TENNCC,
	SDT = @SDT,
	DIACHI = @DIACHI
	WHERE MANCC = @MANCC
END
<<<<<<< HEAD
---HOADON
DROP PROC INSERT_HOADON
CREATE PROC INSERT_HOADON @MAHD VARCHAR(10), @MANV VARCHAR(10),@MAKH VARCHAR(10),@NGAYLAP DATE,@KHUYENMAI FLOAT
AS
BEGIN
	INSERT INTO HOADON
	(
	    MAHD,
	    MANV,
	    MAKH,
		NGAYLAP,
		KHUYENMAI
	)
	VALUES
	(   @MAHD,
		@MANV,  
	    @MAKH,   
	    @NGAYLAP,
		@KHUYENMAI
	)
END
---HOADON
CREATE PROC CHANGE_HOAD @MAHD VARCHAR(10), @MANV VARCHAR(10),@MAKH VARCHAR(10),@NGAYLAP DATE,@KHUYENMAI FLOAT
AS
BEGIN
	UPDATE HOADON SET
	MANV = @MANV,
	MAKH = @MAKH,
	NGAYLAP = @NGAYLAP,
	KHUYENMAI = @KHUYENMAI
	WHERE MAHD = @MAHD
END
---HOADON
CREATE PROC DELETE_HOAD @MAHD VARCHAR(10)
AS
BEGIN
	DELETE HOADON WHERE MAHD = @MAHD
END
---CTHD
CREATE PROC HIENTHI_CTHD @MAHD VARCHAR(10)
AS
BEGIN 
  SELECT * FROM HOADON
  WHERE MAHD = @MAHD
END
EXEC HIENTHI_CTHD 'HD05';
---SANPHAM
drop proc TIM_DANHMUC
CREATE or ALTER PROC TIM_DANHMUC @TENDM NVARCHAR(100)
AS
BEGIN
	SELECT S.MASP, S.TENSP,S.GIATIEN, S.DONVITINH, S.HANSUDUNG, S.SOLUONGTON, S.MAKHO, S.MALOAI
	FROM SANPHAM S, LOAISANPHAM L, DANHMUC DM
	WHERE S.MALOAI = L.MALOAI AND L.MADM = DM.MADM AND DM.TENDM LIKE @TENDM
=======
---NHA
CREATE PROC SEACH_NHACC @MANCC VARCHAR(10)
AS
BEGIN
	SELECT * FROM NHACUNGCAP
	WHERE MANCC = @MANCC
>>>>>>> 75a710f8893a2eb304993394c51cc36fd69a9a9a
END